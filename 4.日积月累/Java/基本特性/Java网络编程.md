# java网络编程
## 深入web请求架构
### B/S网络架构概述
当一个用户在浏览器中输入一个URL，例如www.taobao.com：
1. 首先它会请求DNS把这个域名解析成对应的IP地址
2. 根据这个IP地址在互联网上找到对应的服务器
3. 向服务器发送一个get请求
4. 由服务器决定返回默认的数据资源给访问的用户

在服务器端实际上还有很复杂的业务逻辑：服务器可能由很多台，到底指定哪台服务器处理请求，需要一个负载均衡设备来平均分配所有用户的请求；
还有就是请求的数据是存储在分布式缓存中还是一个静态文件中，或是在数据库里；
当数据返回给浏览器时，浏览器解析数据发现还有一些静态资源时，又会发起另外的HTTP请求，而这些请求很可能会在CDN上，那么CDN服务器会处理这个用户的请求

发起一个HTTP请求的过程就是建立一个Socket通信的过程。

告诉服务器端要获取最新的数据而不是缓存，可以按ctrl+F5，会在请求头中增加两个配置项:
`Pragma:no-cache`和`Cache-Control:no-cache`后者优先级比较高。

`Expires`是设置缓存过期时间

`Last-Modified/Etag` 通过最新修改时间来判断当前请求的资源是不是最新的

###  DNS域名解析
1. 浏览器会检查缓存中有没有这个域名对应的解析过的IP地址，如果缓存中有，这个解析过程就将结束
2. 如果浏览器缓存中没有，浏览器就会查找操作系统缓存中是否有这个域名对应的DNS解析结果
3. 如果在本机中无法完成域名解析，就会请求域名解析器，把域名发送到本机设置的LDNS，本地区的域名解析器中。
4. 如果LDNS仍然没有命中，就直接到Root Server域名服务器请求解析
5. 根域名服务器返回本地域名服务器一个所查询域的主域名服务器gTLD地址
6. 本地域名服务器再向上一步的顶级域名解析器gTLD服务器发送请求
7. 接受请求的gTLD服务器查找并返回此域名对应的Name Server域名服务器的地址，通常是你注册的域名服务器
8. Name Server域名服务器会查询存储的域名与IP的映射关系表，连同一个TTL值返回给DNS Server域名解析器
9. Local DNS Server会缓存这个域名和IP的对应关系，缓存时间由TTL控制
10. 把解析的结果返回给用户，用户根据TTL值缓存在本地，域名解析过程结束

（在实际的DNS解析过程中，可能不止10个步骤，Name Server可能有很多级，或者有一个GTM（全局流量管理）来负载均衡控制）


